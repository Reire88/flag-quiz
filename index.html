<!doctype html>

<html lang="he" dir="rtl"><head>  <meta charset="utf-8" />  <meta name="viewport" content="width=device-width,initial-scale=1" />  <title>חידון דגלים</title>  <style>
  
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(#fff,#f4f4f4);color:#111}
  
    .wrap{max-width:520px;margin:0 auto;padding:16px}
  
    .card{background:#fff;border-radius:22px;box-shadow:0 6px 18px rgba(0,0,0,.08);padding:16px}
  
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  
    .pill{background:rgba(0,0,0,.06);padding:6px 10px;border-radius:999px;font-size:13px}
  
    .btn{border:0;border-radius:16px;padding:12px 14px;font-weight:700;cursor:pointer}
  
    .btnPrimary{background:#111;color:#fff;flex:1}
  
    .btnGhost{background:rgba(0,0,0,.06);color:#111}
  
    .btn:disabled{opacity:.45;cursor:not-allowed}
  
    .flag{width:100%;height:220px;object-fit:cover;border-radius:22px;border:1px solid #111; box-sizing:border-box}
  
    .big{font-size:30px;font-weight:900}
  
    .ok{color:#0a7a2b}
  
    .bad{color:#b00020}
  
    .muted{color:rgba(0,0,0,.6);font-size:13px;line-height:1.6}
  
    .heard{margin-top:8px;font-size:13px;color:rgba(0,0,0,.6)}
  
    .fb{margin-top:12px;background:rgba(0,0,0,.06);border-radius:18px;padding:12px}
  
    .animalBox{display:flex;align-items:center;justify-content:space-between;gap:12px}
  
    .animalPaw{display:flex;align-items:center;justify-content:center;background:#fff;border-radius:22px;box-shadow:0 6px 18px rgba(0,0,0,.08)}
  

  
.fbTitle{display:flex;align-items:center;gap:10px}
  
.iconOk{font-size:40px;line-height:1;color:#0a7a2b;font-weight:900}
  
.iconBad{font-size:40px;line-height:1;color:#b00020;font-weight:900}
  

  
  </style></head><body>  <div class="wrap"><div class="row" style="margin-bottom:14px">

  <div style="font-size:20px;font-weight:800">חידון דגלים</div>

  <span class="pill">קובץ אחד</span>

</div>



<div id="app" class="card"></div>



<div class="muted" style="text-align:center;margin-top:14px">

  עובד הכי טוב ב־Chrome באנדרואיד. יש לאשר גישת מיקרופון.

</div>

  </div><script>
  
  // --- Dataset קטן לדוגמה (אפשר להרחיב) ---
  

  

  
 // --- Dataset ---
  
const COUNTRIES = [
  
  // ישראל ושכנות
  
  { iso2:"il", he:"ישראל", answers:["ישראל","israel"] },
  
  { iso2:"eg", he:"מצרים", answers:["מצרים","egypt"] },
  
  { iso2:"jo", he:"ירדן", answers:["ירדן","jordan"] },
  
  { iso2:"lb", he:"לבנון", answers:["לבנון","lebanon"] },
  
  { iso2:"sy", he:"סוריה", answers:["סוריה","syria"] },
  

  
  // מערב אירופה
  
  { iso2:"pt", he:"פורטוגל", answers:["פורטוגל","portugal"] },
  
  { iso2:"es", he:"ספרד", answers:["ספרד","spain"] },
  
  { iso2:"fr", he:"צרפת", answers:["צרפת","france"] },
  
  { iso2:"gb", he:"הממלכה המאוחדת", answers:["בריטניה","בריטניה הגדולה","הממלכה המאוחדת","אנגליה","uk","united kingdom","england","great britain"] },
  
  { iso2:"ie", he:"אירלנד", answers:["אירלנד","ireland"] },
  
  { iso2:"nl", he:"הולנד", answers:["הולנד","netherlands"] },
  
  { iso2:"be", he:"בלגיה", answers:["בלגיה","belgium"] },
  
  { iso2:"lu", he:"לוקסמבורג", answers:["לוקסמבורג","luxembourg"] },
  
  { iso2:"de", he:"גרמניה", answers:["גרמניה","germany","deutschland"] },
  
  { iso2:"ch", he:"שווייץ", answers:["שווייץ","switzerland"] },
  
  { iso2:"at", he:"אוסטריה", answers:["אוסטריה","austria"] },
  
  { iso2:"it", he:"איטליה", answers:["איטליה","italy"] },
  
  { iso2:"dk", he:"דנמרק", answers:["דנמרק","denmark"] },
  
  { iso2:"no", he:"נורווגיה", answers:["נורווגיה","norway"] },
  
  { iso2:"se", he:"שוודיה", answers:["שוודיה","sweden"] },
  
  { iso2:"pl", he:"פולין", answers:["פולין","poland"] },
  
  { iso2:"cz", he:"צ׳כיה", answers:["צכיה","צ'כיה","czech","czech republic"] },
  
  { iso2:"gr", he:"יוון", answers:["יוון","greece"] },
  
  { iso2:"hr", he:"קרואטיה", answers:["קרואטיה","croatia"] },
  

  
  // מעל 80 מיליון תושבים
  
  { iso2:"us", he:"ארצות הברית", answers:["ארצות הברית","אמריקה","usa","united states"] },
  
  { iso2:"cn", he:"סין", answers:["סין","china"] },
  
  { iso2:"in", he:"הודו", answers:["הודו","india"] },
  
  { iso2:"id", he:"אינדונזיה", answers:["אינדונזיה","indonesia"] },
  
  { iso2:"pk", he:"פקיסטן", answers:["פקיסטן","pakistan"] },
  
  { iso2:"ng", he:"ניגריה", answers:["ניגריה","nigeria"] },
  
  { iso2:"br", he:"ברזיל", answers:["ברזיל","brazil"] },
  
  { iso2:"bd", he:"בנגלדש", answers:["בנגלדש","bangladesh"] },
  
  { iso2:"ru", he:"רוסיה", answers:["רוסיה","russia"] },
  
  { iso2:"mx", he:"מקסיקו", answers:["מקסיקו","mexico"] },
  
  { iso2:"jp", he:"יפן", answers:["יפן","japan"] },
  
  { iso2:"ph", he:"הפיליפינים", answers:["פיליפינים","הפיליפינים","philippines"] },
  
  { iso2:"vn", he:"וייטנאם", answers:["וייטנאם","vietnam"] },
  
  { iso2:"tr", he:"טורקיה", answers:["טורקיה","turkey"] },
  
  { iso2:"ir", he:"איראן", answers:["איראן","iran"] },
  
  { iso2:"et", he:"אתיופיה", answers:["אתיופיה","ethiopia"] },
  

  
  // חצי גמר מונדיאל (נוספים)
  
  { iso2:"ar", he:"ארגנטינה", answers:["ארגנטינה","argentina"] },
  
  { iso2:"uy", he:"אורוגוואי", answers:["אורוגוואי","uruguay"] },
  
  { iso2:"ma", he:"מרוקו", answers:["מרוקו","morocco"] },
  
  { iso2:"kr", he:"דרום קוריאה", answers:["דרום קוריאה","קוריאה הדרומית","south korea"] },
  
];
  

  
if (COUNTRIES.length < 10) {
  
  alert("אין מספיק מדינות ברשימה כדי ליצור סיבוב של 10 שאלות. הוסף עוד מדינות.");
  
}
  
  function shuffle(arr){
  
    const a=[...arr];
  
    for(let i=a.length-1;i>0;i--){
  
      const j=Math.floor(Math.random()*(i+1));
  
      [a[i],a[j]]=[a[j],a[i]];
  
    }
  
    return a;
  
  }
  
  function pick10Unique(list){ return shuffle(list).slice(0,10); }
  

  
  function normalizeText(s){
  
    return (s||"").toLowerCase().trim()
  
      .replace(/[.,!?:;\-_/|"'(){}]/g," ")
  
      .replace(/[ \t\r\n]+/g," ");
  
  }
  

  
  // --- "סלחנות" לדיבור בעברית ---
  
  function normalizeHebrew(s){
  
    const noNikud=(s||"")
  
      .replace(/[֑-ׇ]/g,"") // ניקוד/טעמים
  
      .replace(/[׳״]/g,"")
  
      .replace(/[\"'“”‘’`]/g,"");
  
    return normalizeText(noNikud)
  
      .replace(/ך/g,"כ").replace(/ם/g,"מ").replace(/ן/g,"נ").replace(/ף/g,"פ").replace(/ץ/g,"צ");
  
  }
  
  function stripSpaces(s){ return (s||"").replace(/ /g,""); }
  
  function levenshtein(a,b){
  
    a=a||""; b=b||"";
  
    if(a===b) return 0;
  
    const al=a.length, bl=b.length;
  
    if(!al) return bl; if(!bl) return al;
  
    const v0=new Array(bl+1), v1=new Array(bl+1);
  
    for(let i=0;i<=bl;i++) v0[i]=i;
  
    for(let i=0;i<al;i++){
  
      v1[0]=i+1;
  
      for(let j=0;j<bl;j++){
  
        const cost=a[i]===b[j]?0:1;
  
        v1[j+1]=Math.min(v1[j]+1, v0[j+1]+1, v0[j]+cost);
  
      }
  
      for(let j=0;j<=bl;j++) v0[j]=v1[j];
  
    }
  
    return v1[bl];
  
  }
  
  function buildAnswerVariants(raw){
  
    const base=normalizeHebrew(raw);
  
    const set=new Set();
  
    if(!base) return set;
  
    set.add(base); set.add(stripSpaces(base));
  
    if(base.includes("ארצות הברית")){
  
      set.add(normalizeHebrew("ארהב"));
  
      set.add(normalizeHebrew("ארה ב"));
  
      set.add(stripSpaces(normalizeHebrew("ארהב")));
  
    }
  
    const stripped=base
  
      .replace(/^מדינת[ ]+/g,"")
  
      .replace(/^הרפובליקה[ ]+של[ ]+/g,"")
  
      .trim();
  
    if(stripped && stripped!==base){
  
      set.add(stripped); set.add(stripSpaces(stripped));
  
    }
  
    return set;
  
  }
  
  function isSpokenMatch(spoken, expectedVariants){
  
    const t=spoken; if(!t) return false;
  
    const ts=stripSpaces(t);
  
    for(const e of expectedVariants){
  
      if(!e) continue;
  
      if(t===e) return true;
  
      if(t.includes(e) || e.includes(t)) return true;
  
      const es=stripSpaces(e);
  
      if(ts && es && (ts===es || ts.includes(es) || es.includes(ts))) return true;
  
      const len=Math.max(ts.length, es.length);
  
      const maxEdits=len<=4?1:len<=8?2:3;
  
      if(len>=3 && levenshtein(ts,es)<=maxEdits) return true;
  
    }
  
    return false;
  
  }
  

  
 function scoreAnimal(score){
  
  const map=[
  
    {min:0,max:1,animal:"נמלה", key:"ant", size:0.9},
  
    {min:2,max:3,animal:"חתול", key:"cat", size:1.0},
  
    {min:4,max:5,animal:"כלב", key:"dog", size:1.15},
  
    {min:6,max:7,animal:"כבשה", key:"sheep", size:1.3},
  
    {min:8,max:9,animal:"פרה", key:"cow", size:1.5},
  
    {min:10,max:10,animal:"פיל", key:"elephant", size:1.8},
  
  ];
  
  return map.find(m=>score>=m.min && score<=m.max) || map[0];
  
}
  
  
  
function animalImageUrl(animalKey){
  
  // Twemoji SVG CDN
  
  const base = "https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/";
  
  const map = {
  
    ant: "1f41c",
  
    cat: "1f408",
  
    dog: "1f415",
  
    sheep: "1f411",
  
    cow: "1f42e",
  
    elephant: "1f418",
  
  };
  
  return base + map[animalKey] + ".svg";
  
}
  

  
  // --- Speech Recognition ---
  
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  
  const supported = !!SR;
  
  const rec = supported ? new SR() : null;
  
  if(rec){
  
    rec.lang="he-IL";
  
    rec.interimResults=false;
  
    rec.maxAlternatives=5;
  
  }
  

  
  // --- State ---
  
  let phase="start"; // start|quiz|result
  
  let round=pick10Unique(COUNTRIES);
  
  let idx=0, score=0;
  
  let listening=false;
  
  let feedback=null; // {ok, he}
  
  let lastHeard="";
  
  let errorMsg="";
  

  
  const app = document.getElementById("app");
  

  
  function render(){
  
    if(phase==="start"){
  
      app.innerHTML = `
  
        <div style="font-size:18px;font-weight:800;margin-bottom:6px">מוכנים?</div>
  
        <div class="muted">בכל סיבוב יש <b>10 שאלות</b>. בכל שאלה מוצג דגל. אמור/י בקול את שם המדינה.</div>
  
        ${!supported ? `<div class="fb" style="background:#fff3cd">הדפדפן לא תומך בזיהוי דיבור. מומלץ Chrome באנדרואיד.</div>` : ``}
  
        <button class="btn btnPrimary" style="width:100%;margin-top:14px" onclick="startRound()">התחל סיבוב</button>
  
      `;
  
      return;
  
    }
  

  
    if(phase==="quiz"){
  
      const c = round[idx];
  
      const url = `https://flagcdn.com/w640/${c.iso2}.png`;
  
      app.innerHTML = `
  
        <div class="row" style="margin-bottom:10px">
  
          <span class="pill">שאלה ${idx+1} / 10</span>
  
          <span class="pill">ניקוד: ${score}</span>
  
        </div>
  

  
        <img class="flag" src="${url}" alt="Flag ${c.he}" onerror="onImgError()" />
  

  
        ${errorMsg ? `<div class="fb" style="background:#ffe9ea;color:#b00020;margin-top:10px">${errorMsg}</div>` : ``}
  

  
        <div class="card" style="box-shadow:none;padding:0;margin-top:12px">
  
          <div class="muted">לחץ/י “התחל לדבר” ואמור/י בקול את שם המדינה.</div>
  

  
          <div style="display:flex;gap:10px;margin-top:10px">
  
            <button class="btn btnPrimary" ${(!supported || listening || feedback) ? "disabled":""} onclick="startListening()">
  
              ${listening ? "מקשיב…" : "התחל לדבר"}
  
            </button>
  
            <button class="btn btnGhost" ${(!supported || !listening) ? "disabled":""} onclick="stopListening()">עצור</button>
  
          </div>
  

  
          ${lastHeard ? `<div class="heard">שמעתי: <b style="color:#111">${escapeHtml(lastHeard)}</b></div>` : ``}
  

  
          ${feedback ? `
  
            <div class="fb" style="margin-top:12px">
  
             <div class="fbTitle">
  
  <div class="big ${feedback.ok ? "ok":"bad"}">${feedback.ok ? "נכון" : "לא נכון"}</div>
  
  <div class="${feedback.ok ? "iconOk" : "iconBad"}">${feedback.ok ? "✓" : "✕"}</div>
  
</div>
  
              <div style="font-size:18px;font-weight:800;margin-top:2px">${feedback.he}</div>
  
            </div>
  
          `:``}
  
        </div>
  
      `;
  
      return;
  
    }
  

  
    if(phase==="result"){
  
      const a=scoreAnimal(score);
  
      const w = Math.round(96*a.size), h = Math.round(96*a.size);
  
      app.innerHTML = `
  
        <div style="font-size:18px;font-weight:800">סיימנו!</div>
  
        <div class="big" style="margin-top:6px">${score} / 10</div>
  

  
        <div class="fb" style="margin-top:14px">
  
          <div class="animalBox">
  
            <div>
  
              <div class="muted">החיה שלך</div>
  
              <div style="font-size:24px;font-weight:900">${a.animal}</div>
  
            
  
            </div>
  
           <div class="animalPaw" style="width:${w}px;height:${h}px; padding:10px">
  
  <img src="${animalImageUrl(a.key)}" alt="${a.animal}" style="width:100%;height:100%;object-fit:contain" />
  
</div>
  
          </div>
  
        </div>
  

  
        <div style="display:flex;gap:10px;margin-top:14px">
  
          <button class="btn btnPrimary" style="flex:1" onclick="startRound()">סיבוב נוסף</button>
  
          <button class="btn btnGhost" onclick="goHome()">חזרה</button>
  
        </div>
  
      `;
  
    }
  
  }
  

  
  function escapeHtml(s){
  
    return (s||"").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  
  }
  

  
  window.startRound = function(){
  
    errorMsg=""; lastHeard=""; feedback=null;
  
    round = pick10Unique(COUNTRIES);
  
    idx=0; score=0;
  
    phase="quiz";
  
    render();
  
  };
  
  window.goHome = function(){ phase="start"; render(); };
  

  
  window.onImgError = function(){
  
    errorMsg="לא הצלחתי לטעון דגל. בדוק חיבור לאינטרנט.";
  
    render();
  
  };
  

  
  window.startListening = function(){
  
    if(!supported) return;
  
    errorMsg=""; feedback=null; lastHeard="";
  
    try{
  
      listening=true;
  
      render();
  
      rec.onresult = (e)=>{
  
        const alts=[];
  
        for(let i=0;i<e.results.length;i++){
  
          const r=e.results[i];
  
          for(let j=0;j<r.length;j++){
  
            alts.push({t:r[j].transcript, conf:r[j].confidence});
  
          }
  
        }
  
        const c=round[idx];
  

  
        const normalizedHebAlts = alts.map(a=>normalizeHebrew(a.t)).filter(Boolean);
  
        lastHeard = normalizedHebAlts[0] || "";
  
        const expected = new Set();
  
        c.answers.forEach(ans => buildAnswerVariants(ans).forEach(v=>expected.add(v)));
  
        buildAnswerVariants(c.he).forEach(v=>expected.add(v));
  

  
        const ok = normalizedHebAlts.some(t => isSpokenMatch(t, expected));
  
        feedback = { ok, he: c.he };
  
        if(ok) score++;
  

  
        listening=false;
  
        render();
  

  
        setTimeout(()=>{
  
          feedback=null; lastHeard="";
  
          if(idx>=9){ phase="result"; }
  
          else { idx++; }
  
          render();
  
        }, 900);
  
      };
  

  
      rec.onerror = (e)=>{
  
        listening=false;
  
        errorMsg = (e && e.error==="not-allowed")
  
          ? "אין גישה למיקרופון. תן הרשאה ל-Chrome."
  
          : "שגיאה בזיהוי הדיבור. נסה שוב.";
  
        render();
  
      };
  

  
      rec.onend = ()=>{
  
        listening=false;
  
        render();
  
      };
  

  
      rec.start();
  
    }catch(err){
  
      listening=false;
  
      errorMsg="לא הצלחתי להתחיל הקלטה (אולי לחצת פעמיים). נסה שוב.";
  
      render();
  
    }
  
  };
  

  
  window.stopListening = function(){
  
    if(!supported) return;
  
    try{ rec.stop(); }catch(e){}
  
  };
  

  
  render();
  
</script></body></html>
